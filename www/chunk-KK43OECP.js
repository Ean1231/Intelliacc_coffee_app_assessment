import{b as l,fa as S,ga as d,p as c,w as g}from"./chunk-YY4OCJP3.js";import{a,b as n}from"./chunk-JHI3MBHO.js";var p=(()=>{let e=class e{constructor(){this.STORAGE_KEY="coffee_ui_errors",this.ERROR_PERSISTENCE_DURATION=300*1e3,this.loadingStateSignal=g({isLoading:!1}),this.errorsSignal=g(this.loadPersistedErrors()),this.loadingState$=new l({isLoading:!1}),this.errorsSubject$=new l(this.loadPersistedErrors()),this.hasErrors=S(()=>this.errorsSignal().length>0),this.criticalErrors=S(()=>this.errorsSignal().filter(r=>r.type==="server"&&"statusCode"in r&&r.statusCode&&r.statusCode>=500||r.type==="network")),d(()=>{this.loadingState$.next(this.loadingStateSignal()),this.errorsSubject$.next(this.errorsSignal())}),d(()=>{this.persistErrors(this.errorsSignal())})}get loading$(){return this.loadingState$.asObservable()}get errors$(){return this.errorsSubject$.asObservable()}get loadingState(){return this.loadingStateSignal.asReadonly()}get errors(){return this.errorsSignal.asReadonly()}get isLoading(){return this.loadingStateSignal().isLoading}startLoading(r,t){this.loadingStateSignal.set({isLoading:!0,operation:r,progress:t})}updateProgress(r){let t=this.loadingStateSignal();t.isLoading&&this.loadingStateSignal.set(n(a({},t),{progress:r}))}stopLoading(){this.loadingStateSignal.set({isLoading:!1})}addError(r){let t=this.errorsSignal();this.errorsSignal.set([...t,r])}clearErrors(){this.errorsSignal.set([])}removeError(r){let t=this.errorsSignal();if(r>=0&&r<t.length){let s=[...t];s.splice(r,1),this.errorsSignal.set(s)}}clearErrorsByType(r){let s=this.errorsSignal().filter(i=>i.type!==r);this.errorsSignal.set(s)}loadPersistedErrors(){try{let r=localStorage.getItem(this.STORAGE_KEY);if(!r)return[];let t=JSON.parse(r);return Date.now()-t.timestamp>this.ERROR_PERSISTENCE_DURATION?(localStorage.removeItem(this.STORAGE_KEY),[]):t.errors.map(i=>n(a({},i),{timestamp:new Date(i.timestamp)}))}catch(r){return console.warn("Failed to load persisted errors:",r),localStorage.removeItem(this.STORAGE_KEY),[]}}persistErrors(r){try{if(r.length===0){localStorage.removeItem(this.STORAGE_KEY);return}let t={errors:r,timestamp:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.warn("Failed to persist errors:",t)}}};e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{p as a};
