import{a as se,b as pe,c as de,e as me,g as fe,i as ue,l as ge,m as he,n as F}from"./chunk-CF5QEULE.js";import"./chunk-6XSXO7E7.js";import"./chunk-QUJFQN2Y.js";import"./chunk-62ANCUO6.js";import"./chunk-YDWIN6JP.js";import"./chunk-YYZX4MSL.js";import"./chunk-K7ANV5EX.js";import"./chunk-H5WCI56D.js";import"./chunk-MTHBQ3JQ.js";import"./chunk-7FY2OE2O.js";import"./chunk-NK6UWMPO.js";import"./chunk-KI2I3J5Z.js";import"./chunk-Q2WOCK7O.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-A6RYBWJQ.js";import"./chunk-CKP3SGE2.js";import"./chunk-Y7BKXW6A.js";import{$ as D,A as h,B as b,Ca as M,D as I,Da as G,Ea as W,G as v,Ga as H,H as A,Ha as X,J as u,K as d,Ka as $,L as s,La as Z,M as f,Ma as J,R as C,S as _,_ as g,aa as z,cb as K,db as Q,eb as Y,fb as ee,gb as te,ha as k,hb as ie,ib as ne,kb as oe,la as N,lb as ae,mb as B,nb as re,ob as ce,p as S,pb as le,q as y,rb as w,ta as q,va as V,z as T}from"./chunk-CFUTD7MG.js";import"./chunk-Y2PDZ72K.js";import"./chunk-GOEAN3WI.js";import"./chunk-SNC2IU6J.js";import"./chunk-5SDHGKAM.js";import"./chunk-BXPB4ZAG.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-REYR55MP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as p}from"./chunk-JHI3MBHO.js";function we(o,i){if(o&1&&(d(0,"div",4),g(1),s()),o&2){let l=_(2);h(),D(l.ui.loadingState().operation)}}function Ce(o,i){if(o&1&&(d(0,"div",1),f(1,"ion-spinner",2),v(2,we,2,1,"div",3),s()),o&2){let l=_();h(2),u("ngIf",l.ui.loadingState().operation)}}var be=(()=>{let i=class i{constructor(t){this.ui=t}};i.\u0275fac=function(e){return new(e||i)(b(w))},i.\u0275cmp=I({type:i,selectors:[["app-loading-overlay"]],decls:1,vars:1,consts:[["class","overlay",4,"ngIf"],[1,"overlay"],["name","crescent"],["class","label",4,"ngIf"],[1,"label"]],template:function(e,n){e&1&&v(0,Ce,3,1,"div",0),e&2&&u("ngIf",n.ui.loadingState().isLoading)},dependencies:[N,k,te],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#00000040;z-index:2000}.label[_ngcontent-%COMP%]{margin-top:8px;color:#fff;font-size:14px}"]});let o=i;return o})();var ve=(()=>{let i=class i{constructor(t,e){this.ui=t,this.toast=e}scan(){return p(this,null,function*(){this.ui.startLoading("Scanning barcode");try{let e=window?.cordova?.plugins?.barcodeScanner;return e&&typeof e.scan=="function"?yield new Promise(n=>{e.scan(a=>{!a.cancelled&&a.text?n(a.text):n(null)},()=>n(null))}):(yield this.toast.error("Barcode scanner not available in browser."),null)}finally{this.ui.stopLoading()}})}};i.\u0275fac=function(e){return new(e||i)(y(w),y(F))},i.\u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();var P=(function(o){return o.Prompt="PROMPT",o.Camera="CAMERA",o.Photos="PHOTOS",o})(P||{}),E=(function(o){return o.Rear="REAR",o.Front="FRONT",o})(E||{}),R=(function(o){return o.Uri="uri",o.Base64="base64",o.DataUrl="dataUrl",o})(R||{});var O=class extends le{getPhoto(i){return p(this,null,function*(){return new Promise((l,t)=>p(this,null,function*(){if(i.webUseInput||i.source===P.Photos)this.fileInputExperience(i,l,t);else if(i.source===P.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=i.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:i.promptLabelPhoto||"From Photos"},{title:i.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",n=>p(this,null,function*(){n.detail===0?this.fileInputExperience(i,l,t):this.cameraExperience(i,l,t)}))}else this.cameraExperience(i,l,t)}))})}pickImages(i){return p(this,null,function*(){return new Promise((l,t)=>p(this,null,function*(){this.multipleFileInputExperience(l,t)}))})}cameraExperience(i,l,t){return p(this,null,function*(){if(customElements.get("pwa-camera-modal")){let e=document.createElement("pwa-camera-modal");e.facingMode=i.direction===E.Front?"user":"environment",document.body.appendChild(e);try{yield e.componentOnReady(),e.addEventListener("onPhoto",n=>p(this,null,function*(){let a=n.detail;a===null?t(new B("User cancelled photos app")):a instanceof Error?t(a):l(yield this._getCameraPhoto(a,i)),e.dismiss(),document.body.removeChild(e)})),e.present()}catch{this.fileInputExperience(i,l,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(i,l,t)})}fileInputExperience(i,l,t){let e=document.querySelector("#_capacitor-camera-input"),n=()=>{var a;(a=e.parentNode)===null||a===void 0||a.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",a=>{let r=e.files[0],c="jpeg";if(r.type==="image/png"?c="png":r.type==="image/gif"&&(c="gif"),i.resultType==="dataUrl"||i.resultType==="base64"){let m=new FileReader;m.addEventListener("load",()=>{if(i.resultType==="dataUrl")l({dataUrl:m.result,format:c});else if(i.resultType==="base64"){let x=m.result.split(",")[1];l({base64String:x,format:c})}n()}),m.readAsDataURL(r)}else l({webPath:URL.createObjectURL(r),format:c}),n()}),e.addEventListener("cancel",a=>{t(new B("User cancelled photos app")),n()})),e.accept="image/*",e.capture=!0,i.source===P.Photos||i.source===P.Prompt?e.removeAttribute("capture"):i.direction===E.Front?e.capture="user":i.direction===E.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(i,l){let t=document.querySelector("#_capacitor-camera-input-multiple"),e=()=>{var n;(n=t.parentNode)===null||n===void 0||n.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",n=>{let a=[];for(let r=0;r<t.files.length;r++){let c=t.files[r],m="jpeg";c.type==="image/png"?m="png":c.type==="image/gif"&&(m="gif"),a.push({webPath:URL.createObjectURL(c),format:m})}i({photos:a}),e()}),t.addEventListener("cancel",n=>{l(new B("User cancelled photos app")),e()})),t.accept="image/*",t.click()}_getCameraPhoto(i,l){return new Promise((t,e)=>{let n=new FileReader,a=i.type.split("/")[1];l.resultType==="uri"?t({webPath:URL.createObjectURL(i),format:a,saved:!1}):(n.readAsDataURL(i),n.onloadend=()=>{let r=n.result;l.resultType==="dataUrl"?t({dataUrl:r,format:a,saved:!1}):t({base64String:r.split(",")[1],format:a,saved:!1})},n.onerror=r=>{e(r)})})}checkPermissions(){return p(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return p(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return p(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return p(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},De=new O;var U=ce("Camera",{web:()=>new O});var xe=(()=>{let i=class i{constructor(t,e,n){this.ui=t,this.toast=e,this.zone=n}pick(t){return p(this,null,function*(){this.ui.startLoading(t==="camera"?"Taking photo":"Choosing photo");try{let e=t==="camera"?P.Camera:t==="photos"?P.Photos:P.Prompt;if(re.isNativePlatform()){let r=yield U.checkPermissions();if(r.camera!=="granted"||r.photos!=="granted"){let j=yield U.requestPermissions({permissions:["camera","photos"]});if(j.camera!=="granted"&&e===P.Camera)return yield this.toast.error("Camera permission denied"),null;if(j.photos!=="granted"&&e===P.Photos)return yield this.toast.error("Photos permission denied"),null}let c=yield U.getPhoto({source:e,resultType:R.DataUrl,quality:70}),m=c?.path||c?.webPath||"photo.jpg",x=c?.dataUrl||(c?.base64String?`data:image/jpeg;base64,${c.base64String}`:c?.webPath||c?.path);return x?{dataUrl:x,fileName:m}:null}let n=window,a=n?.Capacitor?.Plugins?.Camera||n?.Camera;if(a?.getPhoto){let r=yield a.getPhoto({source:e,resultType:"dataUrl",quality:70}),c=r?.path||r?.webPath||"photo.jpg",m=r?.dataUrl||(r?.base64String?`data:image/jpeg;base64,${r.base64String}`:r?.webPath||r?.path);return m?{dataUrl:m,fileName:c}:null}return yield new Promise(r=>{let c=document.createElement("input");c.type="file",c.accept="image/*",c.onchange=()=>{let m=c.files?.[0];if(!m)return r(null);let x=new FileReader;x.onload=()=>this.zone.run(()=>r({dataUrl:String(x.result),fileName:m.name})),x.readAsDataURL(m)},c.click()})}catch{return yield this.toast.error("Failed to get image"),null}finally{this.ui.stopLoading()}})}};i.\u0275fac=function(e){return new(e||i)(y(w),y(F),y(A))},i.\u0275prov=S({token:i,factory:i.\u0275fac,providedIn:"root"});let o=i;return o})();function Oe(o,i){if(o&1&&f(0,"img",25),o&2){let l=_();u("src",l.photoPreview,T)}}function Se(o,i){o&1&&f(0,"ion-icon",26)}function Ie(o,i){o&1&&(d(0,"div",27),g(1,"Name is required"),s())}function ke(o,i){o&1&&(d(0,"div",27),g(1,"Enter a valid number"),s())}function Ne(o,i){o&1&&(d(0,"div",27),g(1,"Enter a valid number"),s())}function Be(o,i){o&1&&(d(0,"div",27),g(1,"Enter a valid number"),s())}var rt=(()=>{let i=class i{constructor(t,e,n,a,r,c,m){this.fb=t,this.db=e,this.router=n,this.route=a,this.actionSheet=r,this.barcode=c,this.image=m,this.form=this.fb.group({barcode:["",[]],name:["",[M.required]],pricePerBox:[0,[M.min(0)]],pricePerPod:[0,[M.min(0)]],podsPerBox:[0,[M.min(0)]],photoName:[""]}),se({arrowBack:de,scan:ue,camera:me,add:pe,image:fe})}goBack(){this.router.navigate(["flavours"])}onScan(){return p(this,null,function*(){let t=yield this.barcode.scan();if(t){this.form.patchValue({barcode:t});let e=this.db.getFlavours().find(n=>n.barcode===t);e&&(this.form.patchValue({name:e.name,pricePerBox:e.pricePerBox,pricePerPod:e.pricePerPod,podsPerBox:e.podsPerBox,photoName:e.photoName||""}),this.photoPreview=e.photoData),this.recalculatePricePerPod()}})}onPickPhoto(){return p(this,null,function*(){console.log("[ManageFlavour] onPickPhoto tapped");let t=yield this.image.pick("prompt");t&&(this.photoPreview=t.dataUrl,this.form.patchValue({photoName:t.fileName}))})}capturePhoto(t){return p(this,null,function*(){let e=yield this.image.pick(t==="camera"?"camera":"photos");e&&(this.photoPreview=e.dataUrl,this.form.patchValue({photoName:e.fileName}))})}buildPayload(t){return{barcode:t.barcode||"",name:t.name||"",pricePerBox:Number(t.pricePerBox)||0,pricePerPod:Number(t.pricePerPod)||0,podsPerBox:Number(t.podsPerBox)||0,photoName:t.photoName||void 0,photoData:this.photoPreview}}onSave(){if(this.form.invalid)return;let t=this.form.value,e=this.route.snapshot.paramMap.get("id"),n=this.buildPayload(t);e?this.db.updateFlavour(e,n):this.db.addFlavour(n),this.router.navigate(["flavours"])}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(t){let e=this.db.getFlavour(t);e&&(this.form.patchValue({barcode:e.barcode,name:e.name,pricePerBox:e.pricePerBox,pricePerPod:e.pricePerPod,podsPerBox:e.podsPerBox,photoName:e.photoName||""}),this.photoPreview=e.photoData)}this.form.get("pricePerBox")?.valueChanges.subscribe(()=>this.recalculatePricePerPod()),this.form.get("podsPerBox")?.valueChanges.subscribe(()=>this.recalculatePricePerPod()),this.recalculatePricePerPod()}recalculatePricePerPod(){let t=this.form.get("pricePerBox")?.value,e=this.form.get("podsPerBox")?.value,n=Number(t)||0,a=Number(e)||0,r=a>0?Number((n/a).toFixed(2)):0;this.form.patchValue({pricePerPod:r},{emitEvent:!1})}};i.\u0275fac=function(e){return new(e||i)(b($),b(he),b(V),b(q),b(ge),b(ve),b(xe))},i.\u0275cmp=I({type:i,selectors:[["app-manage-flavour"]],features:[z([])],decls:46,vars:9,consts:[[3,"translucent"],[1,"toolbar-brown"],["slot","start"],["fill","clear",1,"circle-btn",3,"click"],["name","arrow-back"],["slot","end"],["name","scan"],[1,"toolbar-shadow"],[1,"manage-content",3,"fullscreen"],[1,"form-container",3,"formGroup"],[1,"field"],[1,"barcode-row"],["formControlName","barcode","placeholder",""],["tappable","",1,"photo-tile",3,"click"],["alt","preview",3,"src",4,"ngIf"],["name","camera",4,"ngIf"],["formControlName","name","placeholder",""],["class","error",4,"ngIf"],[1,"row"],["formControlName","pricePerBox","type","number"],["formControlName","pricePerPod","type","number"],["formControlName","podsPerBox","type","number"],["slot","fixed",1,"save-strip"],[1,"save-btn",3,"click"],["name","add"],["alt","preview",3,"src"],["name","camera"],[1,"error"]],template:function(e,n){e&1&&(d(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),C("click",function(){return n.goBack()}),f(4,"ion-icon",4),s()(),d(5,"ion-title"),g(6,"MANAGE FLAVOURS"),s(),d(7,"ion-buttons",5)(8,"ion-button",3),C("click",function(){return n.onScan()}),f(9,"ion-icon",6),s()()(),f(10,"ion-toolbar",7),s(),d(11,"ion-content",8),f(12,"app-loading-overlay"),d(13,"div",9)(14,"div",10)(15,"label"),g(16,"BARCODE"),s(),d(17,"div",11),f(18,"ion-input",12),d(19,"div",13),C("click",function(){return n.onPickPhoto()}),v(20,Oe,1,1,"img",14)(21,Se,1,0,"ion-icon",15),s()()(),d(22,"div",10)(23,"label"),g(24,"FLAVOUR NAME"),s(),f(25,"ion-input",16),v(26,Ie,2,0,"div",17),s(),d(27,"div",18)(28,"div",10)(29,"label"),g(30,"PRICE PER BOX"),s(),f(31,"ion-input",19),v(32,ke,2,0,"div",17),s(),d(33,"div",10)(34,"label"),g(35,"PRICE PER POD"),s(),f(36,"ion-input",20),v(37,Ne,2,0,"div",17),s()(),d(38,"div",10)(39,"label"),g(40,"PODS PER BOX"),s(),f(41,"ion-input",21),v(42,Be,2,0,"div",17),s()(),d(43,"div",22)(44,"button",23),C("click",function(){return n.onSave()}),f(45,"ion-icon",24),s()()()),e&2&&(u("translucent",!0),h(11),u("fullscreen",!0),h(2),u("formGroup",n.form),h(7),u("ngIf",n.photoPreview),h(),u("ngIf",!n.photoPreview),h(5),u("ngIf",n.form.controls.name.touched&&n.form.controls.name.invalid),h(6),u("ngIf",n.form.controls.pricePerBox.invalid&&n.form.controls.pricePerBox.touched),h(5),u("ngIf",n.form.controls.pricePerPod.invalid&&n.form.controls.pricePerPod.touched),h(5),u("ngIf",n.form.controls.podsPerBox.invalid&&n.form.controls.podsPerBox.touched))},dependencies:[N,k,Z,G,W,J,H,X,Y,ee,ie,ne,Q,K,oe,ae,be],styles:[".toolbar-brown[_ngcontent-%COMP%]{--background: #7a412d;--color: #ffffff;--border-width: 0;text-transform:uppercase;letter-spacing:.5px}.toolbar-shadow[_ngcontent-%COMP%]{--background: #7a412d;height:4px;box-shadow:inset 0 -4px #5f2f1f}.circle-btn[_ngcontent-%COMP%]{width:34px;height:34px;border-radius:50%;background:#ffffff26;display:flex;align-items:center;justify-content:center}.flavours-content[_ngcontent-%COMP%]{--background: #f6f6f6}.flavours-list[_ngcontent-%COMP%]{padding:12px}.flavour-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e6e6e6;border-radius:2px;padding:12px;display:flex;align-items:center;justify-content:space-between;margin:12px 4px}.flavour-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.flavour-name[_ngcontent-%COMP%]{font-weight:700;color:#7a412d}.flavour-code[_ngcontent-%COMP%]{font-size:12px;color:#9aa0a6}.flavour-actions[_ngcontent-%COMP%]{display:flex;gap:15px;margin-top:6px}.flavour-actions[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:50px;color:#9aa0a6;fill:#9aa0a6;width:24px!important;height:24px!important}.action-btn[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:3px;background:#fff;display:inline-flex;align-items:center;justify-content:center}.flavour-right[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:56px;height:56px}.dev-instructions[_ngcontent-%COMP%]{padding:12px 16px 28px;color:#8f8f8f;font-size:12px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:var(--ion-color-medium)}.manage-content[_ngcontent-%COMP%]{--background: #ffffff;padding-bottom:180px}.form-container[_ngcontent-%COMP%]{padding:12px 16px 8px}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:10px 0 18px}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:11px;color:#9aa0a6;margin-bottom:8px}ion-input[_ngcontent-%COMP%]{border-bottom:1px solid #e3e3e3;--padding-start: 0;--padding-end: 0}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px}.barcode-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 72px;align-items:center;gap:12px}.photo-tile[_ngcontent-%COMP%]{width:72px;height:72px;position:relative;z-index:1;display:inline-flex;align-items:center;justify-content:center}.photo-tile[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border:1px solid #dfe3e6;border-radius:3px;cursor:pointer}.photo-tile[_ngcontent-%COMP%]   .camera-btn[_ngcontent-%COMP%]{position:absolute;inset:0;background:transparent;--padding-start: 0;--padding-end: 0}.photo-tile[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:28px;pointer-events:none}.camera-btn[_ngcontent-%COMP%]{width:72px;height:72px;border:1px solid #dfe3e6;border-radius:3px;background:#f7fbff;display:flex;align-items:center;justify-content:center}.dev-instructions[_ngcontent-%COMP%]{padding:20px 16px;color:#8f8f8f;font-size:12px}.dev-instructions[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{color:#b3b3b3;text-transform:uppercase}.save-strip[_ngcontent-%COMP%]{position:fixed;left:0;right:0;bottom:0;height:200px;background:#8a4a36;display:flex;align-items:center;justify-content:center;z-index:1000}.save-btn[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:50%;border:5px solid #ffffff;background:transparent;color:#fff;display:flex;align-items:center;justify-content:center;font-size:36px}"]});let o=i;return o})();export{rt as ManageFlavourPage};
